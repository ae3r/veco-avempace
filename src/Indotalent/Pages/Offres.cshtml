@page
@model Indotalent.Pages.OffresModel
@{
}

<style>
    .offers-title {
        display: none; /* Hide by default; we’ll toggle this in JS */
        opacity: 0; /* Start transparent */
        margin-top: 2rem;
        transition: opacity 0.8s ease-in-out; /* Fallback transition */
    }

        .offers-title h2 {
            font-size: 2rem; /* Adjust as you like */
            color: #007bff; /* Make it pop with brand color */
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1.2px;
        }

    @@keyframes fadeInUp {
        from {
            transform: translate3d(0, 50px, 0);
            opacity: 0;
        }

        to {
            transform: translate3d(0, 0, 0);
            opacity: 1;
        }
    }

    .offers-title.fade-in-up {
        display: block !important; /* Make sure we see it */
        animation: fadeInUp 1.2s ease-in-out forwards;
    }

    #projectDetailsLeft,
    #projectDetails,
    #projectDetailsRight,
    #projectDetailsLeftAppartement,
    #projectDetailsAppartement,
    #projectDetailsRightAppartement {
        height: 670px;
        overflow-y: auto;
    }

    .maison-btn {
        width: 500px;
        height: 130px;
        border: 1px solid #ddd;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        font-size: 18px;
        color: #333;
        transition: transform 0.3s, box-shadow 0.3s;
    }

        .maison-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 10px rgba(0, 0, 0, 0.15);
        }

    .maison-icon {
        font-size: 40px;
        color: #00aaff;
    }

    .maison-text {
        font-weight: bold;
        margin-top: 10px;
    }

    .styled-box {
        background-color: #f8f9fa;
        border: 1px solid #ddd;
        border-radius: 8px;
        padding: 20px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .slider-container .slider {
        width: 60%;
    }

    .slider-labels {
        display: flex;
        justify-content: space-between;
        width: 60%;
        margin: 0 auto;
        font-weight: bold;
        font-size: 14px;
    }

    .slider-output {
        font-weight: bold;
        font-size: 18px;
        color: #333;
    }

    .choice-button {
        width: 250px;
        text-align: center;
        font-size: 16px;
        padding: 10px;
        border-radius: 8px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        margin: 5px 0;
        transition: all 0.3s ease;
    }

        .choice-button:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 8px rgba(0, 0, 0, 0.15);
        }

    .final-box {
        background-color: #007bff;
        color: white;
        padding: 20px;
        border-radius: 8px;
        font-size: 18px;
        font-weight: bold;
        width: 90%;
        max-width: 500px;
        margin: 0 auto;
        text-align: center;
    }

    .project-details-box {
        background-color: #f4f4f4;
        border: 1px solid #ddd;
        border-radius: 8px;
        padding: 20px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        text-align: left;
        width: 90%;
        max-width: 500px;
        margin: 0 auto;
    }

        .project-details-box h5 {
            font-size: 20px;
            font-weight: bold;
        }

        .project-details-box ul {
            margin-left: 20px;
            list-style-type: disc;
            color: #007bff;
        }

        .project-details-box p {
            font-size: 18px;
            font-weight: bold;
            color: #007bff;
            margin-top: 15px;
        }

    .retour-btn {
        font-size: 16px;
        padding: 10px 20px;
        border-radius: 8px;
    }

    .appartment-btn {
        width: 500px;
        height: 130px;
        border: 1px solid #ddd;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        font-size: 18px;
        color: #333;
        transition: transform 0.3s, box-shadow 0.3s;
    }

        .appartment-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 10px rgba(0, 0, 0, 0.15);
        }

    .appartment-icon {
        font-size: 40px;
        color: #00aaff;
    }

    .appartment-text {
        font-weight: bold;
        margin-top: 10px;
    }

    .entreprise-btn {
        width: 500px;
        height: 130px;
        border: 1px solid #ddd;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        font-size: 18px;
        color: #333;
        transition: transform 0.3s, box-shadow 0.3s;
    }

        .entreprise-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 10px rgba(0, 0, 0, 0.15);
        }

    .entreprise-icon {
        font-size: 40px;
        color: #00aaff;
    }

    .entreprise-text {
        font-weight: bold;
        margin-top: 10px;
    }

    .solution-container,
    .distance-container {
        background-color: #f8f9fa;
        border: 1px solid #ddd;
        border-radius: 8px;
        padding: 20px;
        max-width: 600px;
        margin: 0 auto;
        text-align: center;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .solution-box {
        border: 1px solid #ccc;
        border-radius: 8px;
        padding: 15px;
        margin: 10px 0;
        background-color: #f1f1f1;
        text-align: left;
        cursor: pointer;
    }

        .solution-box:hover {
            background-color: #e0e0e0;
        }

        .solution-box.selected {
            background-color: #007bff;
            color: white;
        }

    .solution-title {
        font-weight: bold;
        font-size: 18px;
    }

    .solution-description {
        margin-top: 5px;
        font-size: 14px;
    }

    .solution-buttons {
        margin-top: 20px;
    }

        .solution-buttons .btn {
            margin: 5px;
            width: 120px;
        }

    #appartmentSolution {
        margin-bottom: 20px;
    }

    #finalAmount {
        font-size: 24px;
        font-weight: bold;
        margin-top: 10px;
    }

    #finalOffer {
        margin-top: 10px;
        font-size: 18px;
        color: #ffffff;
        font-weight: bold;
    }

    @@media (max-width: 768px) {
        .d-flex.justify-content-between.align-items-start.mt-4 {
            flex-direction: column;
            align-items: center;
        }

            .d-flex.justify-content-between.align-items-start.mt-4 > div.mx-2 {
                margin-bottom: 20px;
            }
    }
</style>

<div class="container-fluid py-5">
    <div class="container py-5">
        <div class="section-title text-center position-relative pb-3 mb-5 mx-auto" style="max-width: 600px;">
            <h5 class="fw-bold text-primary text-uppercase">Faites-nous confiance !</h5>
            <h1 class="mb-0">Rejoignez la révolution électrique avec VECO Avempace</h1>
        </div>

        <!-- Button Maison -->
        <div class="d-flex justify-content-center mb-1">
            <button id="maisonButton" class="btn btn-light text-center shadow-lg rounded maison-btn" onclick="showStep2()">
                <div class="maison-icon">
                    <i class="bi bi-house-door-fill"></i>
                </div>
                <div class="maison-text">Maison</div>
            </button>
        </div>

        <!-- Button Appartement -->
        <div class="d-flex justify-content-center mb-1">
            <button id="appartmentButton" class="btn btn-light text-center shadow-lg rounded appartment-btn" onclick="showAppartmentSolution()">
                <div class="appartment-icon">
                    <i class="bi bi-building"></i>
                </div>
                <div class="appartment-text">Appartement</div>
            </button>
        </div>

        <!-- Button Entreprise -->
        <div class="d-flex justify-content-center mb-5">
            <button id="entrepriseButton" class="btn btn-light text-center shadow-lg rounded entreprise-btn" onclick="showForm()">
                <div class="entreprise-icon">
                    <i class="bi bi-building"></i>
                </div>
                <div class="entreprise-text">Entreprise</div>
            </button>
        </div>

        <!-- Step for "Appartement" choice -->
        <div id="appartmentSolution" class="solution-container section-margin" style="display: none;">
            <h5 class="text-center">Vous recherchez une solution de recharge</h5>
            <div class="solution-box collective" onclick="selectSolution('Collective')">
                <div class="solution-title">Collective</div>
                <div class="solution-description">
                    Solution à moindre coût grâce à la mutualisation des installations avec d'autres copropriétaires
                </div>
            </div>
            <div class="solution-box individuelle" onclick="selectSolution('Individuelle')">
                <div class="solution-title">Individuelle</div>
                <div class="solution-description">
                    Infrastructure individuelle
                </div>
            </div>
            <div class="solution-buttons text-center">
                <button class="btn btn-outline-primary" onclick="goBack()">Retour</button>
                <button id="nextButton" class="btn btn-primary" onclick="goToNext()">Suivant</button>
            </div>
        </div>

        <!-- Distance Estimation -->
        <div id="distanceEstimation" class="distance-container section-margin" style="display: none; margin-top: 70px;">
            <h5 class="text-center">Etage de mon appartement</h5>
            <div class="form-group">
                <label for="appartmentFloor">Etage de mon appartement</label>
                <select id="appartmentFloor" class="form-control">
                    <option>--Veuillez sélectionner votre choix--</option>
                </select>
            </div>
        </div>

        <!-- Dynamic Recommendation -->
        <div id="dynamicRecommendation" style="display: none; margin-top: 80px; margin-bottom: 70px;text-align: center;">
            <h5 id="dynamicRecommendationText">Je veux pouvoir piloter et suivre précisément la consommation d'électricité liée à ma recharge (borne connectée)</h5>
            <div class="choices mt-3">
                <button class="btn btn-primary choice-button" onclick="handleChoice2('yes')">Oui, (recommandé)</button>
                <button class="btn btn-primary choice-button" onclick="handleChoice2('no')">Non</button>
            </div>

            <div id="blueBox" style="display: none; margin-top: 20px; text-align: center;">
                <div class="final-box">
                    <span id="blueBoxText">Votre projet à partir de :</span>
                    <div id="finalAmountText" style="font-size: 24px; font-weight: bold; margin-top: 10px;"></div>
                    <div id="finalOfferText" style="margin-top: 10px; font-size: 18px; color: #ffffff; font-weight: bold;"></div>
                    <div id="additionalText" style="margin-top: 10px; font-size: 16px; color: #ffffff;"></div>
                </div>
            </div>
        </div>

        <!-- Maison Step -->
        <div id="step2Content" class="styled-box" style="display: none;">
            <h5 class="text-center mb-4">La distance entre le tableau électrique et le point de charge sera de (en mètres)...</h5>
            <div class="slider-container text-center">
                <input type="range"
                       id="distanceSlider"
                       min="0"
                       max="3"
                       value="0"
                       step="1"
                       class="slider"
                       oninput="updateSliderLabel(this.value)"
                       onchange="displayRecommendation(this.value)" />
                <div class="slider-labels mt-3">
                    <span></span>
                    <span>- 10m</span>
                    <span>10m &lt; d &lt; 20m</span>
                    <span>+ 20m</span>
                </div>
                <div id="sliderOutput" class="slider-output mt-4"></div>
            </div>
        </div>

        <!-- Choice Section (Maison) -->
        <div id="choiceSection" class="styled-box" style="display: none; margin-top: 70px;margin-bottom: 70px; text-align: center;">
            <h5>Je veux pouvoir piloter et suivre précisément la consommation d'électricité liée à ma recharge (borne connectée)</h5>
            <div class="choices mt-3">
                <button class="btn btn-primary choice-button" onclick="handleChoice('yes')">Oui, (recommandé)</button>
                <button class="btn btn-primary choice-button" onclick="handleChoice('no')">Non</button>
            </div>
        </div>

        <!-- Recommendation (Maison) -->
        <div id="recommendation" style="display: none; margin-top: 50px; text-align: center;">
            <h5 id="recommendationText">Je veux pouvoir piloter et suivre précisément la consommation d'électricité liée à ma recharge (borne connectée)</h5>
            <div class="choices mt-3">
                <button class="btn btn-primary choice-button" onclick="handleChoice('yes')">Oui, (recommandé)</button>
                <button class="btn btn-primary choice-button" onclick="handleChoice('no')">Non</button>
            </div>
        </div>

        <!--
            ---------------------------------------
            MAISON SECTIONS
            ---------------------------------------
        -->
        <!-- Title above Maison offers -->
        <div id="offersTitleMaison" class="text-center mt-5" style="display: none;">
            <h2>Trois offres sur-mesure, pour toutes vos exigences</h2>
        </div>

        <div class="d-flex justify-content-between align-items-start mt-4">
            <div class="mx-2">
                <div id="finalStepBoxLeft" class="final-box" style="display: none;">
                    <span id="finalStepTextLeft">Votre projet à partir de :</span>
                    <div id="finalAmountLeft" style="font-size: 24px; font-weight: bold; margin-top: 10px;"></div>
                    <div id="finalOfferLeft" style="margin-top: 10px; font-size: 18px; color: #ffffff; font-weight: bold;"></div>
                </div>
                <div id="projectDetailsLeft" class="project-details-box mt-3" style="display: none;"></div>
            </div>

            <div class="mx-2">
                <div id="finalStepBox" class="final-box" style="display: none;">
                    <span id="finalStepText">Votre projet à partir de :</span>
                    <div id="finalAmount" style="font-size: 24px; font-weight: bold; margin-top: 10px;"></div>
                    <div id="finalOffer" style="margin-top: 10px; font-size: 18px; color: #ffffff; font-weight: bold;"></div>
                </div>
                <div id="projectDetails" class="project-details-box mt-3" style="display: none;"></div>
            </div>

            <div class="mx-2">
                <div id="finalStepBoxRight" class="final-box" style="display: none;">
                    <span id="finalStepTextRight">Votre projet à partir de :</span>
                    <div id="finalAmountRight" style="font-size: 24px; font-weight: bold; margin-top: 10px;"></div>
                    <div id="finalOfferRight" style="margin-top: 10px; font-size: 18px; color: #ffffff; font-weight: bold;"></div>
                </div>
                <div id="projectDetailsRight" class="project-details-box mt-3" style="display: none;"></div>
            </div>
        </div>

        <!--
            ---------------------------------------
            APPARTEMENT SECTIONS
            ---------------------------------------
        -->
        <!-- Title above Appartement offers -->
        <div id="offersTitleAppartement" class="text-center mt-5" style="display: none;">
            <h2>Trois offres sur-mesure, pour toutes vos exigences</h2>
        </div>

        <div class="d-flex justify-content-between align-items-start mt-4">
            <div class="mx-2">
                <div id="finalStepBoxLeftAppartement" class="final-box" style="display: none;">
                    <span id="finalStepTextLeftAppartement">Votre projet à partir de :</span>
                    <div id="finalAmountLeftAppartement" style="font-size: 24px; font-weight: bold; margin-top: 10px;"></div>
                    <div id="finalOfferLeftAppartement" style="margin-top: 10px; font-size: 18px; color: #ffffff; font-weight: bold;"></div>
                </div>
                <div id="projectDetailsLeftAppartement" class="project-details-box mt-3" style="display: none;"></div>
            </div>

            <div class="mx-2">
                <div id="finalStepBoxAppartement" class="final-box" style="display: none;">
                    <span id="finalStepTextAppartement">Votre projet à partir de :</span>
                    <div id="finalAmountAppartement" style="font-size: 24px; font-weight: bold; margin-top: 10px;"></div>
                    <div id="finalOfferAppartement" style="margin-top: 10px; font-size: 18px; color: #ffffff; font-weight: bold;"></div>
                </div>
                <div id="projectDetailsAppartement" class="project-details-box mt-3" style="display: none;"></div>
            </div>

            <div class="mx-2">
                <div id="finalStepBoxRightAppartement" class="final-box" style="display: none;">
                    <span id="finalStepTextRightAppartement">Votre projet à partir de :</span>
                    <div id="finalAmountRightAppartement" style="font-size: 24px; font-weight: bold; margin-top: 10px;"></div>
                    <div id="finalOfferRightAppartement" style="margin-top: 10px; font-size: 18px; color: #ffffff; font-weight: bold;"></div>
                </div>
                <div id="projectDetailsRightAppartement" class="project-details-box mt-3" style="display: none;"></div>
            </div>
        </div>

        <!-- Contact Form -->
        <div id="contactblockid" style="display: none; margin-top: 20px; text-align: center;">

            <h5 style="margin-bottom: 1rem; font-weight:600;">
                Prendre contact avec un chargé d'affaires qui vous rappellera sous 24h
            </h5>

            <div class="col-lg-6 offset-lg-3 wow slideInUp" data-wow-delay="0.3s">
                <form id="clients_form">
                    <div class="row g-3">
                        @Html.AntiForgeryToken()
                        <input type="hidden" asp-for="Input.Id" class="ignore" />
                        <input type="hidden" asp-for="Input.TypeWF" class="ignore" id="Input_TypeWF" />
                        <input type="hidden" asp-for="Input.Distance" class="ignore" id="Input_Distance" />
                        <input type="hidden" asp-for="Input.IsConsumptionMonitoring" class="ignore" id="Input_IsConsumptionMonitoring" />

                        <!-- "Firm" field -->
                        <div class="col-md-6" id="firmField">
                            <input type="text" asp-for="Input.Firm" class="form-control border-0 bg-light px-4"
                                   placeholder="Société" style="height: 55px;">
                        </div>

                        <!-- "Stations" field -->
                        <div class="col-md-6" id="stationsField">
                            <input type="number" asp-for="Input.NumberOfStationsToInstall"
                                   class="form-control border-0 bg-light px-4"
                                   placeholder="Nombre de bornes à installer"
                                   style="height: 55px;">
                        </div>

                        <div class="col-md-6">
                            <input type="text" asp-for="Input.Nom" class="form-control border-0 bg-light px-4"
                                   placeholder="Nom" style="height: 55px;">
                        </div>
                        <div class="col-md-6">
                            <input type="text" asp-for="Input.Prenom" class="form-control border-0 bg-light px-4"
                                   placeholder="Prénom" style="height: 55px;">
                        </div>
                        <div class="col-md-6">
                            <input type="email" asp-for="Input.Email" class="form-control border-0 bg-light px-4"
                                   placeholder="Adresse électronique" style="height: 55px;">
                        </div>
                        <div class="col-md-6">
                            <input type="tel" asp-for="Input.Tel" class="form-control border-0 bg-light px-4"
                                   placeholder="Téléphone" style="height: 55px;">
                        </div>
                        <div class="col-12">
                            <input type="text" asp-for="Input.Sujet" class="form-control border-0 bg-light px-4"
                                   placeholder="Sujet" style="height: 55px;">
                        </div>
                        <div class="col-12">
                            <input type="text" asp-for="Input.Adresse" class="form-control border-0 bg-light px-4"
                                   placeholder="Adresse" style="height: 55px;">
                        </div>
                        <div class="col-md-6">
                            <input type="text" asp-for="Input.City" class="form-control border-0 bg-light px-4"
                                   placeholder="Ville" style="height: 55px;">
                        </div>
                        <div class="col-12">
                            <textarea asp-for="Input.Message" class="form-control border-0 bg-light px-4 py-3"
                                      rows="4" placeholder="Message"></textarea>
                        </div>
                        <div class="col-12">
                            <button class="btn btn-primary w-100 py-3" type="submit" id="submitButton">Envoyer</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Retour Button (Global) -->
    <div class="text-center mt-5">
        <button class="btn btn-outline-primary retour-btn" onclick="goBack()">Retour</button>
    </div>
</div>

<!-- Service End -->
<!-- Vendor Start -->
@await Html.PartialAsync("__Vendor")
<!-- Vendor End -->

<script>
    let selectedDistance = 0;
    let appartmentFloor = null;

    // Text blocks for project details
    const essentielProjectDetails = `
      <p style="color:#007bff;font-weight:bold;">Une solution pratique et économique, idéale pour les particuliers ou petites entreprises recherchant une borne de recharge simple, fiable et performante.</p>
      <br>
      <p style="color:#007bff;font-weight:bold;">Principales fonctionnalités :</p>
      <ul style="list-style-type: disc; margin-left:20px;">
          <li>Puissance maximale 7,4kW monophasé</li>
          <li>Gestion via application mobile</li>
          <li>Connectivité Bluetooth/WiFi</li>
          <li>Compatibilité avec les panneaux photovoltaïques</li>
          <li>Classe de protection IP55</li>
      </ul>
    `;

    const smartProjectDetails = `
      <p style="color:#007bff;font-weight:bold;">L’équilibre parfait entre performance et innovation, destinée aux clients souhaitant une gestion optimisée de leur recharge.</p>
      <br>
      <br>
      <p style="color:#007bff;font-weight:bold;">Principales fonctionnalités :</p>
      <ul style="list-style-type: disc; margin-left:20px;">
          <li>Puissance maximale 7,4kW monophasé</li>
          <li>Gestion via application mobile</li>
          <li>Bluetooth/WiFi + port Ethernet</li>
          <li>Equilibrage de puissance jusqu’à 8 bornes</li>
          <li>«100% photovoltaïque» (mode autoconsommation)</li>
          <li>Programmation de la recharge</li>
          <li>Lecteur RFID</li>
      </ul>
    `;

    const premiumProjectDetails = `
      <p style="color:#007bff;font-weight:bold;">L’offre haut de gamme intégrant des technologies durables et connectées, parfaite pour les projets résidentiels ou professionnels exigeants.</p>
      <br>
      <p style="color:#007bff;font-weight:bold;">Principales fonctionnalités :</p>
      <ul style="list-style-type: disc; margin-left:20px;">
          <li>Puissance maximale 22kW triphasé</li>
          <li>Gestion via application mobile</li>
          <li>Bluetooth/WiFi + port Ethernet</li>
          <li>Equilibrage de puissance jusqu’à 8 bornes</li>
          <li>«100% photovoltaïque» (mode autoconsommation)</li>
          <li>Programmation de la recharge</li>
          <li>Lecteur RFID</li>
          <li>Interopérabilité OCPP 1.6 Json</li>
          <li>Dynamic Power Manager jusqu’à 30kW</li>
      </ul>
    `;

    /*
      This helper decides whether to show/hide:
        - "firmField"  => For Entreprise only (type=3)
        - "stationsField" => For Appartement only (type=2)
    */
    function updateFirmFieldVisibility() {
        const formType = document.getElementById("Input_TypeWF").value;

        const firmField = document.getElementById("firmField");
        const stationsField = document.getElementById("stationsField");

        // If user selected Entreprise (3) => show firm, hide stations
        if (formType === "3") {
            firmField.style.display = "block";
            stationsField.style.display = "none";
            return;
        }

        // If user selected Appartement (2) => show stations, hide firm
        if (formType === "2") {
            stationsField.style.display = "block";
            firmField.style.display = "none";
            return;
        }

        // Otherwise => Maison (1) => hide both
        firmField.style.display = "none";
        stationsField.style.display = "none";
    }

    /* ----------------------
       1) MAISON LOGIC
    ----------------------- */
    function showStep2() {
        document.getElementById("step2Content").style.display = "block";
        document.getElementById("appartmentButton").style.display = "none";
        document.getElementById("entrepriseButton").style.display = "none";

        // Hide both titles
        document.getElementById("offersTitleMaison").style.display = "none";
        document.getElementById("offersTitleAppartement").style.display = "none";

        // TypeWF=1 => Maison
        $('#Input_TypeWF').val("1");

        // Reset slider
        const slider = document.getElementById("distanceSlider");
        slider.value = 0;
        updateSliderLabel(0);
    }

    function updateSliderLabel(value) {
        selectedDistance = value;
        const output = document.getElementById("sliderOutput");

        if (value == 0) {
            output.innerText = "";
        } else if (value == 1) {
            output.innerText = "- 10m";
            $('#Input_Distance').val("- 10m");
        } else if (value == 2) {
            output.innerText = "10m < d < 20m";
            $('#Input_Distance').val("10m < d < 20m");
        } else if (value == 3) {
            output.innerText = "+ 20m";
            $('#Input_Distance').val("+ 20m");
        }
    }

    // Hide form if user reselects slider
    function displayRecommendation(value) {
        // Hide Maison final steps
        document.getElementById("offersTitleMaison").style.display = "none";
        document.getElementById("finalStepBox").style.display = "none";
        document.getElementById("finalStepBoxRight").style.display = "none";
        document.getElementById("finalStepBoxLeft").style.display = "none";
        document.getElementById("projectDetailsRight").style.display = "none";
        document.getElementById("projectDetailsLeft").style.display = "none";
        document.getElementById("projectDetails").style.display = "none";

        // Also hide the form
        document.getElementById("contactblockid").style.display = "none";

        if (value > 0) {
            document.getElementById("choiceSection").style.display = "block";
        } else {
            document.getElementById("choiceSection").style.display = "none";
        }
    }

    function handleChoice(choice) {
        const maisonTitle = document.getElementById("offersTitleMaison");
        maisonTitle.style.display = "block";
        maisonTitle.classList.add("fade-in-up");

        const finalStepBoxes = [
            document.getElementById("finalStepBox"),
            document.getElementById("finalStepBoxLeft"),
            document.getElementById("finalStepBoxRight")
        ];

        const finalStepTexts = [
            document.getElementById("finalStepText"),
            document.getElementById("finalStepTextLeft"),
            document.getElementById("finalStepTextRight")
        ];

        const finalOffers = [
            document.getElementById("finalOffer"),
            document.getElementById("finalOfferLeft"),
            document.getElementById("finalOfferRight")
        ];

        const finalAmounts = [
            document.getElementById("finalAmount"),
            document.getElementById("finalAmountLeft"),
            document.getElementById("finalAmountRight")
        ];

        const projectDetailsSections = [
            document.getElementById("projectDetails"),
            document.getElementById("projectDetailsLeft"),
            document.getElementById("projectDetailsRight")
        ];

        let smartAmount, essentielAmount, premiumAmount;

        if (selectedDistance == 1) {
            smartAmount = "12 490MAD";
            essentielAmount = "9 990MAD";
            premiumAmount = "13 490MAD";
        } else if (selectedDistance == 2) {
            smartAmount = "12 790MAD";
            essentielAmount = "10 290MAD";
            premiumAmount = "13 790MAD";
        } else if (selectedDistance == 3) {
            smartAmount = "13 090MAD";
            essentielAmount = "10 490MAD";
            premiumAmount = "14 090MAD";
        }

        const forfaitText = (choice === "yes")
            ? "<br>+ Forfaits sérénité dès 59,90 MAD/Mois"
            : "";

        finalStepTexts[0].innerHTML = `<div style="text-align:center;">Offre Smart<br>À partir de ${smartAmount}${forfaitText}</div>`;
        finalStepTexts[1].innerHTML = `<div style="text-align:center;">Offre Essentiel<br>À partir de ${essentielAmount}${forfaitText}</div>`;
        finalStepTexts[2].innerHTML = `<div style="text-align:center;">Offre Premium<br>À partir de ${premiumAmount}${forfaitText}</div>`;

        // Clear old amounts
        finalAmounts[0].innerText = "";
        finalAmounts[1].innerText = "";
        finalAmounts[2].innerText = "";
        finalOffers[0].innerText = "";
        finalOffers[1].innerText = "";
        finalOffers[2].innerText = "";

        // Assign details
        const detailsArray = [smartProjectDetails, essentielProjectDetails, premiumProjectDetails];
        for (let i = 0; i < 3; i++) {
            finalStepBoxes[i].style.display = "block";
            projectDetailsSections[i].style.display = "block";
            projectDetailsSections[i].innerHTML = detailsArray[i];
        }

        // Show the form, set "IsConsumptionMonitoring"
        document.getElementById("contactblockid").style.display = "block";
        $('#Input_IsConsumptionMonitoring').val(choice === "yes" ? "Oui" : "Non");

        // Now hide or show "Firm" / "Stations"
        updateFirmFieldVisibility();
    }

    /* ----------------------
       2) ENTREPRISE LOGIC
    ----------------------- */
    function showForm() {
        document.getElementById("maisonButton").style.display = "none";
        document.getElementById("appartmentButton").style.display = "none";

        // TypeWF=3 => Entreprise
        $('#Input_TypeWF').val("3");

        // Show the form
        document.getElementById("contactblockid").style.display = "block";

        // Hide or show "Firm" / "Stations"
        updateFirmFieldVisibility();
    }

    /* ----------------------
       3) APPARTEMENT LOGIC
    ----------------------- */
    function showAppartmentSolution() {
        document.getElementById("appartmentSolution").style.display = "block";
        document.getElementById("maisonButton").style.display = "none";
        document.getElementById("entrepriseButton").style.display = "none";

        // Hide both titles
        document.getElementById("offersTitleMaison").style.display = "none";
        document.getElementById("offersTitleAppartement").style.display = "none";

        // TypeWF=2 => Appartement
        $('#Input_TypeWF').val("2");
    }

    let selectedSolution = null;
    function selectSolution(solution) {
        selectedSolution = solution;
        document.querySelectorAll('.solution-box').forEach((box) => {
            box.classList.remove('selected');
        });
        document.querySelector(`.solution-box.${solution.toLowerCase()}`).classList.add('selected');
    }

    function goToNext() {
        document.getElementById("appartmentSolution").style.display = "block";
        document.getElementById("distanceEstimation").style.display = "block";
        populateSelectOptions("appartmentFloor", 0, 10);
    }

    document.getElementById("appartmentFloor").addEventListener("change", function() {
        appartmentFloor = parseInt(this.value);
        checkAndShowRecommendation();
    });

    function checkAndShowRecommendation() {
        if (appartmentFloor !== null) {
            // Show next step
            const dynamicRecommendation = document.getElementById("dynamicRecommendation");
            dynamicRecommendation.style.display = "block";
        }
    }

    // Format amount with a space before each group of 3 digits
    function formatAmountWithSpace(amount) {
        return amount.toString().replace(/\B(?=(\d{3})+(?!\d))/g, " ");
    }

    // When the user picks "Oui"/"Non" for Appartement
    function handleChoice2(choice) {
        document.getElementById("offersTitleAppartement").style.display = "block";

        const finalStepBoxes = [
            document.getElementById("finalStepBoxAppartement"),
            document.getElementById("finalStepBoxLeftAppartement"),
            document.getElementById("finalStepBoxRightAppartement")
        ];

        const finalStepTexts = [
            document.getElementById("finalStepTextAppartement"),
            document.getElementById("finalStepTextLeftAppartement"),
            document.getElementById("finalStepTextRightAppartement")
        ];

        const finalAmounts = [
            document.getElementById("finalAmountAppartement"),
            document.getElementById("finalAmountLeftAppartement"),
            document.getElementById("finalAmountRightAppartement")
        ];

        const finalOffers = [
            document.getElementById("finalOfferAppartement"),
            document.getElementById("finalOfferLeftAppartement"),
            document.getElementById("finalOfferRightAppartement")
        ];

        const projectDetailsSections = [
            document.getElementById("projectDetailsAppartement"),
            document.getElementById("projectDetailsLeftAppartement"),
            document.getElementById("projectDetailsRightAppartement")
        ];

        // Calculate numeric values
        const eValue = 9490 + (300 * appartmentFloor);
        const sValue = 12090 + (300 * appartmentFloor);
        const pValue = 13090 + (300 * appartmentFloor);

        const essentielAmount = formatAmountWithSpace(eValue) + " MAD";
        const smartAmount     = formatAmountWithSpace(sValue) + " MAD";
        const premiumAmount   = formatAmountWithSpace(pValue) + " MAD";

        const forfaitText = (choice === "yes")
            ? "<br>+ Forfaits sérénité dès 59,90 MAD/Mois"
            : "";

        finalStepTexts[0].innerHTML = `
          <div style="text-align:center;">
              Offre Smart<br>À partir de ${smartAmount}${forfaitText}
          </div>`;
        finalStepTexts[1].innerHTML = `
          <div style="text-align:center;">
              Offre Essentiel<br>À partir de ${essentielAmount}${forfaitText}
          </div>`;
        finalStepTexts[2].innerHTML = `
          <div style="text-align:center;">
              Offre Premium<br>À partir de ${premiumAmount}${forfaitText}
          </div>`;

        // Clear old amounts
        finalAmounts[0].innerText = "";
        finalAmounts[1].innerText = "";
        finalAmounts[2].innerText = "";
        finalOffers[0].innerText = "";
        finalOffers[1].innerText = "";
        finalOffers[2].innerText = "";

        // Show details
        const detailsArrayAppartement = [smartProjectDetails, essentielProjectDetails, premiumProjectDetails];
        for (let i = 0; i < 3; i++) {
            finalStepBoxes[i].style.display = "block";
            projectDetailsSections[i].style.display = "block";
            projectDetailsSections[i].innerHTML = detailsArrayAppartement[i];
        }

        // Show the form
        document.getElementById("contactblockid").style.display = "block";
        $('#Input_IsConsumptionMonitoring').val(choice === "yes" ? "Oui" : "Non");

        // Hide or show "Firm" / "Stations"
        updateFirmFieldVisibility();
    }

    // Helper to populate floors
    function populateSelectOptions(selectId, start, end) {
        const select = document.getElementById(selectId);
        select.innerHTML = '<option>--Veuillez sélectionner votre choix--</option>';
        for (let i = start; i <= end; i++) {
            const option = document.createElement("option");
            option.value = i;
            option.textContent = i;
            select.appendChild(option);
        }
    }

    // Hide all relevant sections if user reselects floor
    document.getElementById("appartmentFloor").addEventListener("change", hideSectionsOnSelectChange);
    function hideSectionsOnSelectChange() {
        const sectionsToHide = [
            "step2Content",
            "choiceSection",
            "recommendation",
            "offersTitleMaison",
            "finalStepBox",
            "finalStepBoxRight",
            "finalStepBoxLeft",
            "projectDetailsRight",
            "projectDetailsLeft",
            "projectDetails",
            "blueBox",
            "finalStepBoxAppartement",
            "finalStepBoxRightAppartement",
            "finalStepBoxLeftAppartement",
            "projectDetailsRightAppartement",
            "projectDetailsLeftAppartement",
            "projectDetailsAppartement",
            "offersTitleAppartement"
        ];

        sectionsToHide.forEach(function (id) {
            let element = document.getElementById(id);
            if (element) {
                element.style.display = "none";
            }
        });
        document.getElementById("contactblockid").style.display = "none";
    }

    /* ----------------------
       UNIVERSAL "Retour" LOGIC
    ----------------------- */
    function goBack() {
        document.getElementById("maisonButton").style.display = "block";
        document.getElementById("appartmentButton").style.display = "block";
        document.getElementById("entrepriseButton").style.display = "block";

        document.getElementById("offersTitleMaison").style.display = "none";
        document.getElementById("offersTitleAppartement").style.display = "none";

        const sections = [
            "appartmentSolution",
            "distanceEstimation",
            "dynamicRecommendation",
            "step2Content",
            "choiceSection",
            "recommendation",
            "finalStepBox",
            "projectDetails",
            "contactblockid",
            "blueBox",
            "finalStepBoxRight",
            "finalStepBoxLeft",
            "projectDetailsRight",
            "projectDetailsLeft",
            "finalStepBoxAppartement",
            "finalStepBoxLeftAppartement",
            "finalStepBoxRightAppartement",
            "projectDetailsAppartement",
            "projectDetailsLeftAppartement",
            "projectDetailsRightAppartement",
            "offersTitleMaison",
            "offersTitleAppartement"
        ];

        sections.forEach(function (id) {
            let section = document.getElementById(id);
            if (section) {
                section.style.display = "none";
            }
        });
    }
</script>

<link rel="stylesheet" media="screen, print" href="~/css/notifications/toastr/toastr.min.css" />
<script type="text/javascript" src="~/lib/jquery/dist/jquery-3.4.1.min.js" asp-append-version="true"></script>
<script type="text/javascript" src="~/lib/axios/dist/axios.min.js" asp-append-version="true"></script>
<script type="text/javascript" src="~/js/notifications/toastr/toastr.min.js" asp-append-version="true"></script>

<script type="text/javascript">
    $('#clients_form #submitButton').click(function (e) {
        const request = $('#clients_form').serialize();
        const type = $('#Input_TypeWF').val();
        const distance = $('#Input_Distance').val();
        const isConsumptionMonitoring = $('#Input_IsConsumptionMonitoring').val();

        axios.post('@Url.Page("/Offres")?type=' + type + '&distance=' + distance + '&isConsumptionMonitoring=' + isConsumptionMonitoring, request)
             .then(res => {
                 toastr["info"]('Message envoyé avec succès.');
             });

        event.preventDefault();
        event.stopPropagation();
    });
</script>
