@page
@model Indotalent.Pages.NetworkPanelModel
@{
    ViewData["Title"] = "Network Panel";
}

<!-- CSS references -->
<link rel="stylesheet" href="~/css/bootstrap.min.css" />
<link rel="stylesheet" href="~/css/slick.css" />
<link rel="stylesheet" href="~/css/slick-theme.css" />
<link rel="stylesheet" href="~/css/style.css" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />

<style>
    /* Main content area offset from the fixed navbar */
    .main-content {
        margin-top: 160px; /* Adjust if your navbar height differs */
        padding: 20px;
    }

    /* Panel container (used for both tabs) */
    .panel-container {
        background-color: #fff;
        border: 2px solid #0b7fab;
        border-radius: 8px;
        padding: 20px;
        margin-top: 20px;
        box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }

    /* Vertical sections in the Network Panel tab */
    .panel-section {
        background-color: #f9f9f9;
        border: 1px solid #eee;
        border-radius: 6px;
        padding: 15px;
        margin-bottom: 20px;
    }

        .panel-section h4 {
            margin-top: 0;
            margin-bottom: 10px;
            font-size: 1.2rem;
            font-weight: 600;
        }

    .section-icon {
        margin-right: 8px;
        font-size: 1.2rem;
        color: #333;
    }

    /* Table styling for grid (used in Rechargers tab) */
    .my-table {
        width: 100%;
        border-collapse: separate;
        border-spacing: 0;
        border-radius: 6px;
        overflow: hidden;
    }

        .my-table thead {
            background-color: #0b7fab;
        }

            .my-table thead th {
                color: #fff;
                font-weight: 600;
                padding: 12px;
                border-bottom: 2px solid #0b7fab;
                text-align: left;
            }

        .my-table tbody td {
            padding: 12px;
            border-bottom: 1px solid #eee;
        }

        .my-table tbody tr:hover {
            background-color: #f0f8fa;
        }

    /* Button styles */
    .primary-btn {
        background-color: #0b7fab;
        color: #fff;
        border: none;
        padding: 8px 16px;
        border-radius: 4px;
        cursor: pointer;
    }

        .primary-btn:hover {
            background-color: #095f79;
        }

    /* Top bar (items per page + filter) */
    .top-bar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
    }

        .top-bar .items-per-page select {
            border: 1px solid #ddd;
            padding: 5px 8px;
            border-radius: 4px;
        }

    /* Heading area above each tab's grid */
    .heading-bar {
        margin: 20px 0 10px;
        display: flex;
        align-items: center;
        justify-content: space-between;
    }

    /* Pagination styles */
    .pagination-container {
        margin-top: 15px;
        display: flex;
        gap: 10px;
    }

    .page-btn {
        background-color: #0b7fab;
        color: #fff;
        border: none;
        border-radius: 4px;
        padding: 5px 10px;
        cursor: pointer;
    }

        .page-btn:hover {
            background-color: #095f79;
        }

    /* Bootstrap nav-tabs override */
    .nav-tabs .nav-link.active {
        background-color: #0b7fab;
        color: #fff;
    }

    /* Charger carousel styles */
    .charger-carousel .charger-card {
        background-color: #fff;
    border: 1px solid #eee;
    border-radius: 2px;  /* reduced corner radius */
    padding: 4px;        /* reduced padding */
    margin: 2px;         /* reduced margin */
    text-align: center;
    cursor: pointer;
    transition: box-shadow 0.2s;
    }

    .charger-carousel .charger-card:hover {
        box-shadow: 0 4px 10px rgba(0,0,0,0.15);
    }

    .charger-image {
    width: 100px;  /* Adjust to desired width */
    height: auto;  /* Keeps aspect ratio */
}

    .charger-info {
        font-size: 0.95rem;
        color: #333;
    }

    .charger-serial {
        font-weight: 600;
    }

    .charger-status {
        color: #f00; /* or brand color if "Disconnected" etc. */
    }

    .charger-power {
        color: #666;
    }

</style>

<body>
    <div class="main-content">
        <!-- Header: Display network name and a Back link -->
        <div class="mb-3">
            <h2>@Model.CurrentNetwork?.NetworkName - Panel</h2>
            <a asp-page="/Networks" class="btn btn-primary">Back to Networks</a>
        </div>
        <div>
            <strong>Debug Network ID:</strong> @Model.CurrentNetwork.Id
        </div>

        <!-- Tabs Navigation (Bootstrap 5) -->
        <ul class="nav nav-tabs" id="networkTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="panel-tab" data-bs-toggle="tab" data-bs-target="#panel" type="button" role="tab" aria-controls="panel" aria-selected="true">
                    Network Panel
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="rechargers-tab" data-bs-toggle="tab" data-bs-target="#rechargers" type="button" role="tab" aria-controls="rechargers" aria-selected="false">
                    Rechargers
                </button>
            </li>
        </ul>

        <!-- Tabs Content -->
        <div class="tab-content" id="networkTabsContent">
            <!-- Network Panel Tab -->
            <div class="tab-pane fade show active" id="panel" role="tabpanel" aria-labelledby="panel-tab">
                <div class="panel-container">
                    <!-- Energy flows section -->
                    <div class="panel-section">
                        <h4><i class="fas fa-charging-station section-icon"></i>Energy flows</h4>
                        <p><strong>Chargers:</strong> __</p>
                        <p><strong>Meter:</strong> __</p>
                        <p><strong>Green recharge:</strong> __</p>
                        <p><strong>Photovoltaic:</strong> __</p>
                    </div>
                    <!-- Meter details -->
                    <div class="panel-section">
                        <h4><i class="fas fa-tachometer-alt section-icon"></i>Meter details</h4>
                        <p>Line 1: __ kW - __ A</p>
                        <p>Line 2: __ kW - __ A</p>
                    </div>
                    <!-- Network layout -->
                    <div class="panel-section">
                        <h4><i class="fas fa-network-wired section-icon"></i>Network layout</h4>
                        <p>Not defined</p>
                    </div>
                    <!-- Users -->
                    <div class="panel-section">
                        <h4><i class="fas fa-users section-icon"></i>Users</h4>
                        <p>1 user or 0 users (placeholder)</p>
                    </div>
                    <!-- RFID -->
                    <div class="panel-section">
                        <h4><i class="fas fa-id-badge section-icon"></i>RFID</h4>
                        <p>0</p>
                    </div>
                    <!-- Dazebox in the network -->
                    <div class="panel-section dazebox-section">
                        <h4><i class="fas fa-box-open section-icon"></i>Dazebox in the network</h4>

                        @if (Model.Chargers != null && Model.Chargers.Any())
                        {
                                <!-- Slick carousel container -->
                                    <div class="charger-carousel" id="chargerCarousel">
                                @foreach (var charger in Model.Chargers)
                                {
                <div class="charger-card"
                     onclick="location.href='@Url.Page("ChargerDetails", new { chargerId = charger.Id })'">
                    <!-- Use the PhotoUrl property; if null or empty, fallback to a default image -->
                            <img src="@(string.IsNullOrEmpty(charger.PhotoUrl) ? Url.Content("~/img/autel.jpg") : charger.PhotoUrl)" alt="Charger Image" class="charger-image" />

                    <div class="charger-info">
                        <p class="charger-serial">@(charger.SerialNumber ?? "N/A")</p>
                        <p class="charger-status">@(charger.ConnectionStatus ?? "N/A")</p>
                        <p class="charger-power">@charger.PowerValue kW</p>
                    </div>
                </div>
                                }
    </div>
                        }
                        else
                        {
                                <p>No data yet.</p>
                        }
                    </div>
                    <!-- Charging sessions -->
                    <div class="panel-section">
                        <h4><i class="fas fa-history section-icon"></i>Charging sessions</h4>
                        <p>No records to display</p>
                    </div>
                    <!-- Energy delivered by chargers -->
                    <div class="panel-section">
                        <h4><i class="fas fa-bolt section-icon"></i>Energy delivered by chargers</h4>
                        <p>0 kWh</p>
                    </div>
                </div>
            </div>

            <!-- Rechargers Tab -->
            <div class="tab-pane fade" id="rechargers" role="tabpanel" aria-labelledby="rechargers-tab">
                <div class="panel-container">
                    <!-- Top bar for grid (optional) -->
                    <div class="top-bar">
                        <div class="items-per-page">
                            <label>Items per page</label>
                            <select>
                                <option>5</option>
                                <option>10</option>
                                <option>25</option>
                                <option>50</option>
                            </select>
                        </div>
                        <button class="primary-btn">Filter</button>
                    </div>

                    <!-- Heading with Create Charger button -->
                    <div class="heading-bar">
                        <h3 style="margin: 0;">All Chargers</h3>
                        <form method="get" asp-page="/CreateCharger">
                            <button type="submit" class="primary-btn">Create Charger</button>
                        </form>
                    </div>

                    <!-- Big plus button above the grid -->
                    <div class="text-center my-4" style="border: 1px dashed #ccc; padding: 30px; border-radius: 10px;">
                        <h5 style="font-weight: bold; margin-bottom: 10px;">Add charging station</h5>
                        <p style="margin-bottom: 15px;">Click on the button to add a new charger</p>
                        <a asp-page="/CreateCharger" asp-route-NetworkId="@Model.CurrentNetwork.Id" style="text-decoration:none;">
                            <button type="button" style="
                                border-radius: 50%;
                                width: 60px;
                                height: 60px;
                                background-color: #0b7fab;
                                color: #fff;
                                font-size: 1.5rem;
                                display: flex;
                                align-items: center;
                                justify-content: center;
                                border: none;
                                box-shadow: 0 2px 6px rgba(0,0,0,0.15);
                            ">
                                <i class="fa fa-plus"></i>
                            </button>
                        </a>
                    </div>

                    <!-- Chargers grid table -->
                    <table class="my-table">
                        <thead>
                            <tr>
                                <th>Charger Name</th>
                                <th>Network Name</th>
                                <th>Charger Status</th>
                                <th>Connection Status</th>
                                <th>Model</th>
                            </tr>
                        </thead>
                        <tbody>
                            @if (Model.Chargers != null && Model.Chargers.Any())
                            {
                                foreach (var charger in Model.Chargers)
                                {
                                            <tr>
                                                <td>@charger.ChargerName</td>
                                                <td>@charger.Network?.NetworkName</td>
                                                <td>@charger.ChargerStatus</td>
                                                <td>@charger.ConnectionStatus</td>
                                                <td>@charger.Model</td>
                                            </tr>
                                }
                            }
                            else
                            {
                                    <tr>
                                        <td colspan="5">No charging stations found.</td>
                                    </tr>
                            }
                        </tbody>
                    </table>

                    <div class="pagination-container">
                        <button class="page-btn">Prev</button>
                        <button class="page-btn">1</button>
                        <button class="page-btn">Next</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- JS references for Bootstrap 5 -->
    <script src="~/js/jquery.min.js"></script>
    <script src="~/js/bootstrap.bundle.min.js"></script>
    <script src="~/landingpage/js/slick.min.js"></script>

    <!-- Initialize Slick carousel for the "Dazebox in the network" section -->
    <script>
        $(document).ready(function() {
            // Only init slick if we have .charger-carousel in the DOM
            if ($('#chargerCarousel').length) {
                $('#chargerCarousel').slick({
                    slidesToShow: 3,
                    slidesToScroll: 1,
                    infinite: false,
                    dots: true,
                    arrows: true
                    // You can add more slick options here
                    // e.g. responsive breakpoints, autoplay, etc.
                });
            }
        });
    </script>
</body>
</html>
