@* _PrivatePurchaseSignupStep2Partial.cshtml *@

<style>
    .private-purchase-step2 h3,
    .private-purchase-step2 h4 {
        text-align: center;
    }

    .private-purchase-step2 h4 {
        font-weight: bold;
        margin-bottom: 30px;
    }

    .password-wrapper {
        position: relative;
    }

    .toggle-password {
        position: absolute;
        right: 10px;
        top: 38px; /* Adjust as needed for your design */
        cursor: pointer;
    }
</style>

<div class="private-purchase-step2">
    <h3>Step 2 of 2</h3>
    <h4>Create new account</h4>

    <div class="row mt-4 justify-content-center">
        <div class="col-md-6">

            <!-- We'll use a normal form but handle it via jQuery .submit() -->
            <form id="createAccountForm">
                <!-- Email -->
                <div class="form-group mb-3">
                    <label for="emailAddress">Email address</label>
                    <input type="email" class="form-control" id="emailAddress" name="emailAddress" required />
                </div>

                <!-- Password -->
                <div class="form-group mb-3 password-wrapper">
                    <label for="password">Password</label>
                    <small class="form-text text-muted">
                        Use at least 12 characters with no parts of your username
                        to ensure your password is safe.
                    </small>
                    <input type="password" class="form-control mt-1" id="password" name="password" required />
                    <i class="fa fa-eye toggle-password" id="togglePassword" title="Show/Hide password"></i>
                </div>

                <!-- Disclaimers -->
                <p class="mt-3">
                    We respect your privacy. Please read our
                    <a href="#" target="_blank">Privacy policy</a>
                    for more information.
                </p>
                <p>
                    By clicking this button, you agree to
                    <a href="#" target="_blank">Terms of service</a>.
                </p>

                <!-- Action buttons -->
                <div class="d-flex justify-content-between align-items-center mt-4">
                    <!-- Back to Step 1 -->
                    <button type="button" class="btn btn-light" onclick="loadPrivatePurchaseStep1()">
                        <i class="fa fa-arrow-left"></i> Back
                    </button>

                    <!-- Create account -->
                    <button type="submit" class="btn btn-primary" id="btnCreateAccount">
                        Create account
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
    // Toggle password visibility
    document.getElementById("togglePassword").addEventListener("click", function() {
        let pwdField = document.getElementById("password");
        if (pwdField.type === "password") {
            pwdField.type = "text";
            this.classList.remove("fa-eye");
            this.classList.add("fa-eye-slash");
        } else {
            pwdField.type = "password";
            this.classList.remove("fa-eye-slash");
            this.classList.add("fa-eye");
        }
    });

    // If user clicks "Back," load Step 1 partial again
    function loadPrivatePurchaseStep1() {
        $.get("@Url.Page("./Login", "PrivatePurchaseSignupPartial")", function (html) {
            $("#signUpChoiceContainer").html(html).slideDown("fast", function () {
                $('html, body').animate({
                    scrollTop: $("#signUpChoiceContainer").offset().top
                }, 600);
            });
        });
    }

    // Intercept form submit to call OnPostCreateAccountAsync
    $("#createAccountForm").on("submit", function (e) {
        e.preventDefault();

        // Gather form data
        var dataToSend = {
            emailAddress: $("#emailAddress").val(),
            password: $("#password").val()
        };

        // POST to /Login?handler=CreateAccount
        $.post("@Url.Page("./Login", "CreateAccount")", dataToSend)
            .done(function(html) {
                // If success, the server returns the "Verification Email Sent" partial
                $("#signUpChoiceContainer").html(html).slideDown("fast", function () {
                    $('html, body').animate({
                        scrollTop: $("#signUpChoiceContainer").offset().top
                    }, 600);
                });
            })
            .fail(function() {
                alert("Error creating account. Please try again.");
            });
    });
</script>
